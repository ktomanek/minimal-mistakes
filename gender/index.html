<head><script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"> </script>
<!--<script src="gender.js"></script> -->
</head> 
<body>
<p id ='out'>Genderflow//</p> 

  <p>Step 1: Upload image...</p>
  <input type="file" onchange="selectImage()"><br>  
  <img id="myImage" src="" alt="an image to come here" width="200" height="200">

  <p>Step 2: Classify...</p>
  <button onclick="classifyImage()">Click here to classify</button></p>

  <p>Step 3: Result...</p>
  <div id="myResultLabel"></div>                                 
  <div id="myResultConf"></div>
  <div id="myResultPred"></div>    
                    
<script>

function selectImage(){
       var preview = document.querySelector('img'); //selects the query named img
       var file    = document.querySelector('input[type=file]').files[0]; //sames as here
       var reader  = new FileReader();
       reader.onloadend = function () {
           preview.src = reader.result;
       }
       if (file) {
           reader.readAsDataURL(file); //reads the data as a URL
       } else {
           preview.src = "";
       }
  }
  

// normalize into some sort of confidence for given class
function norm(v) {
    if (v>0.5) {
        return (v-0.5) / (1.0 - 0.5)
    } else {
        return 1 - ((v-0) / (0.5 - 0))
    }
}
  
async function classifyImage() {
 document.getElementById("myResultLabel").innerHTML = "classsifying image"; 
 document.getElementById("myResultConf").innerHTML = "..."; 
 document.getElementById("myResultPred").innerHTML = "..."; 
 var model = await tf.loadModel('faces_to_gender_v2.h5/model.json')      
 tf.tidy(() => {
   
   
   var img = document.getElementById("myImage");  
   var example =tf.fromPixels(img);
   example = tf.image.resizeBilinear(example, [150, 150]);
   example = tf.cast(example, 'float32')
   example = tf.div(example, 255)
   example = example.reshape([1, 150, 150, 3]); 
  
   var pred = model.predict(example);
 
   // decision
   var conf = norm(pred.dataSync())
   var label = 'x'
   if (pred.dataSync() > 0.5) {
      label='MALE'
  } else {
      label='FEMALE'
  }
                                            
  document.getElementById("myResultLabel").innerHTML = "class: " + label.toString();
  document.getElementById("myResultConf").innerHTML = "confidence: " + parseFloat(conf).toFixed(4);
  document.getElementById("myResultPred").innerHTML = "[raw softmax:" + parseFloat(pred.dataSync()).toFixed(4) + "]";
 });
 model.dispose();
}
  
  
</script>
</body>

<!--
async function classifyImage() {
 document.getElementById("myResultLabel").innerHTML = "you pressed the button"; 
 document.getElementById("myResultConf").innerHTML = "...processing..."; 
 var img = document.getElementById("myImage");  
 // var model = await tf.loadModel('web_model_gender/model.json')
 var model = await tf.loadModel('faces_to_gender_v2.h5/model.json')
 var example =tf.fromPixels(img);
 example = tf.image.resizeBilinear(example, [150, 150]);
 example = example.reshape([1, 150, 150, 3]);  
  
 var pred = model.predict(example);
 var result = pred
 
 // decision
 var conf = pred.dataSync()
 var label = 'x'
 if (conf > 0.5) {
    label='MALE'
} else {
    label='FEMALE'
}
-->
