<head><script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"> </script>
<!--<script src="gender.js"></script> -->
</head> 
<body>
<p id ='out'>GenderflowXX</p> 

  <p>User Image Upload</p>
  <input type="file" onchange="previewFile()"><br>
  <!--<img src="" height="200" alt="Image preview...">  -->
  
  <img id="myImage" src="" alt="an image to come here" width="200" height="200">
  
  <!--
  <p>Canvas</p>
  <canvas id="myCanvas" with="300" height="300" style="border:1px solid #000000;">not supported</canvas>                                                                      
  -->

  <p><button onclick="onCanvas()">Click here to classify</button></p>

  
  
  <p>Result</p>
  <div id="myResultLabel"></div>                                 
  <div id="myResultConf"></div>                                 
                    
<script>
function previewFile(){
       var preview = document.querySelector('img'); //selects the query named img
       var file    = document.querySelector('input[type=file]').files[0]; //sames as here
       var reader  = new FileReader();

       reader.onloadend = function () {
           preview.src = reader.result;
       }

       if (file) {
           reader.readAsDataURL(file); //reads the data as a URL
       } else {
           preview.src = "";
       }
  }
  
async function onCanvas() {
 document.getElementById("myResult").innerHTML = "you pressed the button"; 
 var img = document.getElementById("myImage");  
 // var c = document.getElementById("myCanvas");
 // var ctx = c.getContext("2d");
 // var img = new Image();
 // img.src = "doggie.jpg";  
 // ctx.drawImage(img,10,10);
 // var model =  await tf.loadModel('https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json');
 var model = await tf.loadModel('web_model_gender/model.json')
 document.getElementById("myResult").innerHTML = "loaded the model"; 
 var example =tf.fromPixels(img);
 // example = tf.image.resizeBilinear(example, [224,224]);
 // example = example.reshape([1,224,224,3]);  
 example = tf.image.resizeBilinear(example, [150, 150]);
 example = example.reshape([1, 150, 150, 3]);  
  
 var pred = model.predict(example);
 // var result = pred.as1D().argMax();
 var result = pred
 
 // decision
 var conf = pred.asScalar()
 var label = 'x'
 if (conf > 0.5) {
    label='m'
} else {
    label='f'
}
                                            
 document.getElementById("myResultLabel").innerHTML = label.toString();
  document.getElementById("myResultConf").innerHTML = conf.toString();
}
</script>
</body>
